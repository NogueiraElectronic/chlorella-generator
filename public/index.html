<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generador Dataset Chlorella</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 40px 0; text-align: center; margin-bottom: 30px; }
        .card { background: white; border-radius: 10px; padding: 30px; margin-bottom: 20px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .form-group { margin-bottom: 20px; }
        label { display: block; margin-bottom: 8px; font-weight: 600; color: #333; }
        input, select { width: 100%; padding: 12px; border: 2px solid #e1e1e1; border-radius: 6px; font-size: 16px; }
        input:focus, select:focus { outline: none; border-color: #667eea; }
        .btn { background: #667eea; color: white; padding: 15px 30px; border: none; border-radius: 6px; cursor: pointer; font-size: 16px; font-weight: 600; }
        .btn:hover { background: #5a67d8; }
        .btn:disabled { background: #ccc; cursor: not-allowed; }
        .progress { background: #e1e1e1; border-radius: 10px; height: 20px; margin: 20px 0; }
        .progress-bar { background: #28a745; height: 100%; border-radius: 10px; transition: width 0.3s; }
        .results { background: #d4edda; border: 1px solid #c3e6cb; border-radius: 6px; padding: 20px; margin-top: 20px; }
        .download-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin-top: 20px; }
        .download-btn { background: #28a745; color: white; padding: 12px 20px; text-decoration: none; border-radius: 6px; text-align: center; font-weight: 600; }
        .download-btn:hover { background: #218838; }
        .stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px; }
        .stat-card { background: white; padding: 20px; border-radius: 8px; text-align: center; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .stat-value { font-size: 2em; font-weight: bold; color: #667eea; }
        .stat-label { color: #666; font-size: 0.9em; }
        .hidden { display: none; }
        .loading { text-align: center; padding: 20px; }
        .spinner { border: 4px solid #f3f3f3; border-top: 4px solid #667eea; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 0 auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>
    <div class="header">
        <h1>ðŸ§¬ Generador Dataset Chlorella vulgaris</h1>
        <p>Genera datasets masivos para entrenamiento de modelos de Machine Learning</p>
    </div>
    
    <div class="container">
        <div class="card">
            <h2>ConfiguraciÃ³n del Dataset</h2>
            <div class="form-group">
                <label for="scenarios">NÃºmero de escenarios:</label>
                <input type="number" id="scenarios" value="50" min="1" max="200">
                <small>Cada escenario representa condiciones experimentales diferentes</small>
            </div>
            
            <div class="form-group">
                <label for="hours">Horas por escenario:</label>
                <input type="number" id="hours" value="240" min="24" max="720">
                <small>DuraciÃ³n de cada experimento (240 horas = 10 dÃ­as)</small>
            </div>
            
            <button class="btn" onclick="generateDataset()" id="generateBtn">
                ðŸš€ Generar Dataset
            </button>
        </div>
        
        <div id="progress" class="card hidden">
            <h3>Generando Dataset...</h3>
            <div class="progress">
                <div id="progress-bar" class="progress-bar" style="width: 0%"></div>
            </div>
            <div id="progress-text">Iniciando generaciÃ³n...</div>
            <div class="loading">
                <div class="spinner"></div>
            </div>
        </div>
        
        <div id="results" class="card hidden">
            <h3>âœ… Dataset Generado Exitosamente!</h3>
            <div id="stats" class="stats"></div>
            <div id="downloads" class="download-grid"></div>
        </div>
        
        <div class="card">
            <h3>ðŸ“Š Datasets Generados Anteriormente</h3>
            <div id="existing-datasets">
                <div class="loading">
                    <div class="spinner"></div>
                    <p>Cargando datasets existentes...</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        async function generateDataset() {
            const scenarios = document.getElementById('scenarios').value;
            const hours = document.getElementById('hours').value;
            const generateBtn = document.getElementById('generateBtn');
            
            // Mostrar progreso
            document.getElementById('progress').classList.remove('hidden');
            document.getElementById('results').classList.add('hidden');
            generateBtn.disabled = true;
            generateBtn.textContent = 'Generando...';
            
            const progressBar = document.getElementById('progress-bar');
            const progressText = document.getElementById('progress-text');
            
            try {
                progressText.textContent = 'Iniciando generaciÃ³n de datos...';
                progressBar.style.width = '10%';
                
                const response = await fetch('/generate-dataset', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        scenarios: parseInt(scenarios), 
                        hoursPerScenario: parseInt(hours) 
                    })
                });
                
                if (!response.ok) {
                    throw new Error('Error en la generaciÃ³n del dataset');
                }
                
                const data = await response.json();
                
                if (data.success) {
                    progressBar.style.width = '100%';
                    progressText.textContent = 'Â¡GeneraciÃ³n completada!';
                    
                    // Mostrar estadÃ­sticas
                    const statsHTML = `
                        <div class="stat-card">
                            <div class="stat-value">${data.stats.totalPoints.toLocaleString()}</div>
                            <div class="stat-label">Total de Puntos</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">${data.stats.trainingPoints.toLocaleString()}</div>
                            <div class="stat-label">Entrenamiento</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">${data.stats.validationPoints.toLocaleString()}</div>
                            <div class="stat-label">ValidaciÃ³n</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">${data.stats.testPoints.toLocaleString()}</div>
                            <div class="stat-label">Prueba</div>
                        </div>
                    `;
                    
                    document.getElementById('stats').innerHTML = statsHTML;
                    
                    // Botones de descarga
                    const folderName = data.outputDir.split('/').pop();
                    const downloadsHTML = `
                        <a href="/download/${folderName}/training_data.csv" class="download-btn" download>
                            ðŸ“Š Datos de Entrenamiento
                        </a>
                        <a href="/download/${folderName}/validation_data.csv" class="download-btn" download>
                            ðŸ“Š Datos de ValidaciÃ³n
                        </a>
                        <a href="/download/${folderName}/test_data.csv" class="download-btn" download>
                            ðŸ“Š Datos de Prueba
                        </a>
                        <a href="/download/${folderName}/complete_dataset.csv" class="download-btn" download>
                            ðŸ“Š Dataset Completo
                        </a>
                    `;
                    
                    document.getElementById('downloads').innerHTML = downloadsHTML;
                    document.getElementById('results').classList.remove('hidden');
                    
                    // Actualizar lista de datasets
                    setTimeout(() => {
                        document.getElementById('progress').classList.add('hidden');
                        loadExistingDatasets();
                    }, 2000);
                } else {
                    throw new Error(data.error || 'Error desconocido');
                }
            } catch (error) {
                progressText.textContent = 'Error: ' + error.message;
                progressBar.style.width = '0%';
                progressBar.style.background = '#dc3545';
            } finally {
                generateBtn.disabled = false;
                generateBtn.textContent = 'ðŸš€ Generar Dataset';
            }
        }
        
        async function loadExistingDatasets() {
            try {
                const response = await fetch('/datasets');
                const datasets = await response.json();
                
                const container = document.getElementById('existing-datasets');
                
                if (datasets.length === 0) {
                    container.innerHTML = '<p>No hay datasets generados anteriormente.</p>';
                    return;
                }
                
                const datasetsHTML = datasets.map(dataset => `
                    <div style="border: 1px solid #ddd; padding: 15px; margin: 10px 0; border-radius: 8px; background: white;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <strong>ðŸ“… ${new Date(dataset.created).toLocaleString()}</strong>
                                <br>
                                <small>${dataset.files.length} archivos</small>
                            </div>
                            <div style="text-align: right;">
                                ${dataset.files.map(file => `
                                    <a href="/download/${dataset.id}/${file.name}" 
                                       class="download-btn" 
                                       style="margin: 2px; padding: 8px 12px; font-size: 12px;"
                                       download>
                                        ${file.name.replace('.csv', '')}
                                    </a>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                `).join('');
                
                container.innerHTML = datasetsHTML;
            } catch (error) {
                console.error('Error loading datasets:', error);
                document.getElementById('existing-datasets').innerHTML = 
                    '<p>Error al cargar datasets existentes.</p>';
            }
        }
        
        // Cargar datasets al cargar la pÃ¡gina
        loadExistingDatasets();
        
        // Actualizar cada 30 segundos
        setInterval(loadExistingDatasets, 30000);
    </script>
</body>
</html>
